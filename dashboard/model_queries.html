<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EMMAA dashboard</title>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  
  <!-- C3 css -->
  <link rel="stylesheet" href="./static/css/c3.css">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

  <!-- bootstrap 4.1.3 -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  <!-- AWS SDK -->
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>

  <!-- D3 -->
  <script src="https://d3js.org/d3.v5.min.js"></script>

  <!-- C3 -->
  <script src="./static/js/c3.min.js"></script>

  <!-- Script Files -->
  <!-- <script src="https://indralab.github.io/aws/js/awsServices.js"></script> -->
  <script src="https://s3.amazonaws.com/emmaa-test/awsServices.js"></script>
  <script src="./emmaaFunctions.js"></script>

  <!-- User query JS -->
  <script>
    // EMMAA rest API
    var EMMAA_API = 'https://somewhere.on.aws/submit/'

    function postQuery(queryContainer) {
      console.log('function postQuery(queryContainer)')
      // Get user info
      userInfo = {
        name: 'testUser',
        slack_id: '123456abcdef',
        email: 'test_user@emmaa.com'
      }

      // Collect model query
      let querySel = collectQuery(queryContainer)

      // Check if user wants to register query
      let reg = document.getElementById('register-query').checked

      submitQuery({
        user: userInfo,
        query: querySel,
        register: reg
      })
    }

    function collectQuery(queryContainer) {
      console.log('function collectQuery(queryContainer)')
      let dropdownSelections = queryContainer.getElementsByClassName('custom-select')

      query = {};
      checkboxes = []

      // Get checked models
      for (box of document.getElementById('model-select').getElementsByTagName('input')) {
        console.log(box.name)
        if (!box.disabled && box.checked) {
          checkboxes.push(box.name)
        }
      }
      query['models'] = checkboxes;

      //  Collect dropdown selections
      for (selection of dropdownSelections) {
        selId = selection.id;
        query[selId] = selection.options[selection.selectedIndex].value;
      }

      return query;
    }

    function submitQuery(queryDict) {
      console.log('function submitQuery(queryDict)')
      console.log('Submitting data to query DB')
      console.log(queryDict)
      // submit POST to emmaa user db
      let response = $.ajax({
        url: EMMAA_API,
        type: 'POST',
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify(queryDict),
        complete: function function_name(xhr, statusText) {
          switch (xhr.status) {
            case 200:
              console.log('200 response')
              break;
            case 400:
              console.log('400 response')
              break;
            case 401:
              console.log('401 response')
              break;
            case 404:
              console.log('404 response')
              break;
            default:
              console.log('Unhandled server response')
          }
        }
      })
    }
  </script>

  </head>

  <body>
    <div class="container" id="query-container">

      <!-- checkboxes -->
      <div class="card">
        <div class="card-header">
          <h4 class="my-0 font-weight-normal">Model Queries</h4>
        </div>
        <div class="card-body">

          <div class="checkbox-container" id="model-select">
            <div class="checkbox">
              <label for="aml">
                <input type="checkbox" name="aml" id="aml">AML
              </label>
              <label for="brca">
                <input type="checkbox" name="brca" id="brca" disabled>BRCA (Unavailable)
              </label>
              <label for="luad">
                <input type="checkbox" name="luad" id="luad">LUAD
              </label>
              <label for="paad">
                <input type="checkbox" name="paad" id="paad">PAAD
              </label>
              <label for="prad">
                <input type="checkbox" name="prad" id="prad">PRAD
              </label>
              <label for="skcm">
                <input type="checkbox" name="skcm" id="skcm">SKCM
              </label>
            </div>
          </div>
          <!-- stmt type select -->
          <div class="dropdown" style="display: inline-block; vertical-align: top;">
            <select class="custom-select" id="typeSelection">
              <option value="" selected="selected" disabled="disabled" hidden="hidden">select statement type</option>
              <option value="activation">Activation</option>
              <option value="phosphorylation">Phosphorylation</option>
            </select>
          </div>
          <!-- subject select -->
          <div class="dropdown" style="display: inline-block; vertical-align: top;">
            <select class="custom-select" id="subjectSelection">
              <option value="" selected="selected" disabled="disabled" hidden="hidden">select subject</option>
              <option value="brca1">BRCA1</option>
            </select>
          </div>
          <!-- object select -->
          <div class="dropdown" style="display: inline-block; vertical-align: top;">
            <select class="custom-select" id="objectSelection">
              <option value="" selected="selected" disabled="disabled" hidden="hidden">select object</option>
              <option value="brca2">BRCA2</option>
            </select>
          </div>
          <!-- register query -->
          <div class="register-container">
            <div class="checkbox">
              <input type="checkbox" name="register" id="register-query"><label for="register">Register Query</label>
            </div>
          </div>
        </div>

        <!-- submit button -->
        <div class="container" id="button-container" style="margin: auto;">
          <button class="btn btn-outline-primary" id="status-notify" onClick="postQuery(document.getElementById('query-container'))">Submit query</button>
        </div>

      </div>
    </div>

    <!-- Query results -->
    <div class="container">
      <div class="card">
        <div class="card-header">
          <h4 class="my-0 font-weight-normal">Results</h4>
        </div>
        <div class="card-body" id="query-results">
        </div>
      </div>
    </div>

    <!-- List user queries -->
    <div class="container">
      <div class="card">
        <div class="card-header">
          <h4 class="my-0 font-weight-normal">Your previous queries</h4>
        </div>
        <div class="card-body" id="user-queries">
        </div>
      </div>
    </div>
  </body>

</html>
